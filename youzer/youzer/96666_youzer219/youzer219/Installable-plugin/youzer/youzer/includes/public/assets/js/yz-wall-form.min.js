!function(y){"use strict";y(document).ready(function(){y(".yz-wall-post").on("click",function(){var e,s=0,r=y(this),o=y(this).text(),d=r.closest("form#yz-wall-form"),c={};y.each(d.serializeArray(),function(e,a){"_"!==a.name.substr(0,1)&&"whats-new"!==a.name.substr(0,9)&&(c[a.name]?y.isArray(c[a.name])?c[a.name].push(a.value):c[a.name]=new Array(c[a.name],a.value):c[a.name]=a.value)}),d.find("*").each(function(){(y.nodeName(this,"textarea")||y.nodeName(this,"input"))&&y(this).prop("disabled",!0)}),y(".yz-wall-textarea").get(0).emojioneArea&&y(".yz-wall-textarea").data("emojioneArea").disable(),r.addClass("loading"),r.prop("disabled",!0),d.addClass("submitted"),r.css("min-width",r.css("width")),r.html('<i class="fas fa-spinner fa-spin"></i>');var a="",t=y("#yz-whats-new-post-in").val(),i=y("#whats-new").val(),p=y("#buddypress ul.activity-list li").first(),n=p,l=null;return p.length&&(n.hasClass("load-newest")&&(n=p.next()),l=n.prop("class").match(/date-recorded-([0-9]+)/)),l&&(s=l[1]),0<t&&(a=y("#yz-whats-new-post-object").val()),e=y.extend({action:"yz_post_update",cookie:bp_get_cookies(),_yz_wpnonce_post_update:y("#_yz_wpnonce_post_update").val(),content:i,object:a,item_id:t,since:s,_bp_as_nonce:y("#_bp_as_nonce").val()||""},c),y.post(ajaxurl,e,function(e){if(d.find("*").each(function(){(y.nodeName(this,"textarea")||y.nodeName(this,"input"))&&y(this).prop("disabled",!1)}),y(".yz-wall-textarea").get(0).emojioneArea&&y(".yz-wall-textarea").data("emojioneArea").enable(),y.yz_isJSON(e)){var a=y.parseJSON(e);y.yz_DialogMsg("error",a.error)}else{if(r.html('<i class="fas fa-check"></i>').hide().fadeIn("slow"),d.find(".yz-delete-attachment").trigger("click"),0===y("ul.activity-list").length&&(y("div.error").slideUp(100).remove(),y("#message").slideUp(100).remove(),y("div.activity").append('<ul id="activity-stream" class="activity-list item-list">')),p.hasClass("load-newest")&&p.remove(),y("#activity-stream").prepend(e),s||y("#activity-stream li:first").addClass("new-update just-posted"),y("body,html").animate({scrollTop:y("#"+y(e).attr("id")).offset().top-65+"px"},1e3),0!==y("#latest-update").length){var t=y("#activity-stream li.new-update .activity-content .activity-inner p").html(),i=y("#activity-stream li.new-update .activity-content .activity-header p a.view").attr("href"),n=y("#activity-stream li.new-update .activity-content .activity-inner p").text(),l="";""!==n&&(l=t+" "),l+='<a href="'+i+'" rel="nofollow">'+BP_DTheme.view+"</a>",y("#latest-update").slideUp(300,function(){y("#latest-update").html(l),y("#latest-update").slideDown(300)})}y("li.new-update").hide().slideDown(300),y("li.new-update").removeClass("new-update"),y("#whats-new").val(""),"slideshow"==c.post_type&&y.youzer_sliders_init(),d.get(0).reset(),y(".yz-wall-textarea").get(0).emojioneArea&&y(".yz-wall-textarea").get(0).emojioneArea.setText(""),d.find('.yz-wall-options input:radio[name="post_type"]').first().trigger("change"),d.find(".lp-prepost .lp-button-cancel").trigger("click"),newest_activities="",activity_last_recorded=0}setTimeout(function(){r.html(o).fadeIn("slow")},1e3),y(".yz-wall-post").prop("disabled",!1).removeClass("loading")}),!1}),y('input:radio[name="post_type"]').change(function(){y(this).is(":checked")&&"link"==y(this).val()?y(".yz-wall-link-form").fadeIn():y(".yz-wall-link-form").fadeOut(),y(this).is(":checked")&&"quote"==y(this).val()?y(".yz-wall-quote-form").fadeIn():y(".yz-wall-quote-form").fadeOut(),y(this).is(":checked")&&"status"!=y(this).val()?y(".yz-wall-actions .yz-wall-upload-btn").fadeIn():y(".yz-wall-actions .yz-wall-upload-btn").fadeOut(),y(".yz-attachment-item").remove()});var e=0,t=null,o=y("#yz-wall-form");y(".yz-wall-upload-btn").click(function(e){if(!y.yz_CheckFilesNumber()||o.find(".yz-file-progress")[0])return!1;y("#yz-upload-attachments").click(),e.preventDefault()}),y("#yz-upload-attachments").change(function(e){e.preventDefault();var a=y("#yz-upload-attachments").get(0);t=a,y.yz_UploadFiles({attachments:a,max_size:Yz_Wall.max_size,max_number:20,allowed_extensions:["png","jpg","jpeg","gif","mp4","ogv","ogg","mp3","wav","webm"]})}),y.yz_validate_attachment=function(e,a){var t=y.extend({allowed_extensions:["jpg","jpeg","gif","png"],max_number:3,max_size:3},a);if(e.size>1048576*t.max_size)return y.yz_DialogMsg("error",Yz_Wall.invalid_file_size),!1;if(!y.yz_CheckFilesNumber())return!1;if(o.find(".yz-attachment-item").length+1>t.max_number)return y.yz_DialogMsg("error",Yz_Wall.invalid_files_number),!1;var i=e.name.split(".").pop().toLowerCase();if(y.yz_isPostType("video")){var n=Yz_Wall.video_extentions;if(-1==y.inArray(i,n))return y.yz_DialogMsg("error",Yz_Wall.invalid_video_ext),!1}if(y.yz_isPostType("photo")||y.yz_isPostType("slideshow")){var l=Yz_Wall.image_extentions;if(-1==y.inArray(i,l))return y.yz_DialogMsg("error",Yz_Wall.invalid_image_ext),!1}if(y.yz_isPostType("file")){var s=Yz_Wall.file_extentions;if(-1==y.inArray(i,s))return y.yz_DialogMsg("error",Yz_Wall.invalid_file_ext),!1}if(y.yz_isPostType("audio")){var r=Yz_Wall.audio_extentions;if(-1==y.inArray(i,r))return y.yz_DialogMsg("error",Yz_Wall.invalid_audio_ext),!1}return!0},y.yz_UploadFiles=function(e){for(var a=y.extend({allowed_extensions:Yz_Wall.default_extentions,max_number:3,max_size:3},e),t=a.attachments.files,i=0;i<t.length;i++){var n=t[i];if(!y.yz_validate_attachment(n,a))return!1;var l=y.youzerAttachmentItem({file:n,file_name:n.name});y(".yz-form-attachments").append(l),0==i&&y.yz_UploadFile(n)}},y.youzerAttachmentItem=function(e){var a,t=y.extend({},e);return a='<div class="yz-attachment-item yz-file-preview"><div class="yz-attachment-details"><i class="fas fa-hourglass-half yz-file-icon"></i><span class="yz-file-name">'+y.yz_GetNameExcerpt(t.file_name)+'</span></div><div class="yz-file-progress"><span class="yz-file-upload"></span></div><input type="hidden" class="yz-attachment-data" name="attachments_files[]" /></div>','<div class="yz-attachment-item yz-image-preview"><div class="yz-attachment-details"><i class="fas fa-hourglass-half yz-file-icon"></i></div><div class="yz-file-progress"><span class="yz-file-upload"></span></div><input type="hidden" class="yz-attachment-data" name="attachments_files[]" /></div>',y.yz_CheckIsFileImage(t.file)?'<div class="yz-attachment-item yz-image-preview"><div class="yz-attachment-details"><i class="fas fa-hourglass-half yz-file-icon"></i></div><div class="yz-file-progress"><span class="yz-file-upload"></span></div><input type="hidden" class="yz-attachment-data" name="attachments_files[]" /></div>':a},y.yz_UploadFile=function(l){var s=o.find(".yz-file-progress:first").parent(".yz-attachment-item"),e=new FormData;e.append("image",l),e.append("action","yz_upload_wall_attachments"),e.append("security",o.find('input[name="_yz_wpnonce_post_update"]').val()),y.ajax({type:"POST",url:ajaxurl,data:e,cache:!1,contentType:!1,processData:!1,xhr:function(){var e=y.ajaxSettings.xhr();return e.upload&&(y(".yz-wall-actions .yz-wall-post").attr("disabled",!0),e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var a=e.total,t=100*e.loaded/a,i=s.find(".yz-file-upload");s.find(".yz-file-icon").attr("class","fas fa-spinner fa-spin yz-file-icon"),i.css("width",t+"%"),100<=t&&i.addClass("yz-file-uploaded")}})),e},success:function(e){var a=y.parseJSON(e);if(a.error)return y.yz_DialogMsg("error",a.error),s.remove(),y.yz_CheckUploadProgress(),!1;s.find(".yz-file-progress").fadeOut(400,function(){y(this).remove(),y.yz_upload_next_file(),y.yz_CheckUploadProgress()}),y.yz_CheckIsFileImage(l)&&s.find(".yz-file-icon").remove(),s.find(".yz-file-icon").attr("class","fas fa-paperclip yz-file-icon"),s.find(".yz-attachment-details").append('<i class="fas fa-trash-alt yz-delete-attachment"></i>'),s.find(".yz-attachment-data").val(e);var t=y.parseJSON(e),i=y.map(t,function(e){return e.original}),n=Yz_Wall.base_url+"/temp/"+i[0];s.css("background-image","url("+n+")")},error:function(e,a,t){s.remove(),y.yz_DialogMsg("error",a),y.yz_CheckUploadProgress(),y.yz_upload_next_file()}})},y.yz_upload_next_file=function(){e++,void 0!==t.files[e]&&y.yz_UploadFile(t.files[e])},y.yz_GetNameExcerpt=function(e){if(e.length<=25)return e;var a=25-"...".length,t=Math.ceil(a/2),i=Math.floor(a/2);return e.substr(0,t)+"..."+e.substr(e.length-i)},y(document).on("click",".yz-delete-attachment",function(e){var a=y(this).closest(".yz-attachment-item"),t=y.parseJSON(a.find(".yz-attachment-data").val()),i=y.map(t,function(e){return e.file_name});a.remove(),y.yz_DeleteAttachment(i[0])}),y.yz_DeleteAttachment=function(e){var a=new FormData;a.append("attachment",e),a.append("action","yz_delete_wall_attachment"),a.append("security",o.find('input[name="security"]').val()),y.ajax({type:"POST",data:a,url:Youzer.ajax_url,contentType:!1,processData:!1})},y.yz_CheckIsFileImage=function(e){var a=e.type;return!(y.inArray(a,["image/gif","image/jpeg","image/png"])<0)},y.yz_CheckUploadProgress=function(){y(".youzer .yz-file-progress")[0]||(y("#yz-upload-attachments").val(""),o.find(".yz-wall-post").attr("disabled",!1),e=0,t=null)},y.yz_check_for_uploader_button=function(){"status"!=y('input:radio[name="post_type"]').val()&&y(".yz-wall-actions .yz-wall-upload-btn").fadeIn()},y.yz_check_for_uploader_button(),y.yz_isPostType=function(e){return e==y('input:radio[name="post_type"]:checked').val()},y.yz_CheckFilesNumber=function(){return"photo"==y('input:radio[name="post_type"]:checked').val()||"slideshow"==y('input:radio[name="post_type"]:checked').val()||!y(".yz-attachment-item")[0]||(y.yz_DialogMsg("error",Yz_Wall.max_one_file),!1)}})}(jQuery);